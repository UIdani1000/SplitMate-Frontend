<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SplitMate - Decentralized Bill Splitting</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Assuming wallet.js handles connection, global user/wallet state, and showMessageBox -->
    <script src="wallet.js"></script> 
    
    <style>
        /* Apply Inter font family */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #10002b;
        }
        ::-webkit-scrollbar-thumb {
            background: #7400b8; /* Deep Purple */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #c77dff; /* Bright Electric Purple */
        }
    </style>
    
    <script>
        // --- Tailwind Configuration (UI Theme) ---
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                background: "#10002b",
                card: { DEFAULT: "rgba(255, 255, 255, 0.05)", foreground: "hsl(210 40% 98%)" },
                primary: {
                  DEFAULT: "#c77dff", // Bright Electric Purple
                  active: "#7400b8", // Deep Purple for Button Fill
                  foreground: "hsl(210 40% 98%)",
                },
                secondary: {
                  DEFAULT: "#ff9e00", // Vibrant Orange
                  foreground: "hsl(210 40% 98%)",
                },
                border: "hsl(260 20% 25%)", 
                input: "hsl(260 20% 25%)",
                ring: "hsl(260 20% 25%)",
                foreground: "hsl(210 40% 98%)",
                muted: {
                  DEFAULT: "hsl(215 20% 60%)",
                  foreground: "hsl(215 20% 80%)",
                },
              },
              borderRadius: {
                xl: "1.25rem",
                lg: "1rem",
              }
            }
          }
        }

        // ====================================================================
        // --- GLOBAL UI & MESSAGE BOX ---
        // ====================================================================

        /**
         * Placeholder for global message box function assumed to be in wallet.js
         * If wallet.js is not present, this implementation ensures the UI works.
         */
        window.showMessageBox = function(title, content, onOk = null) {
            document.getElementById('message-title').textContent = title;
            document.getElementById('message-content').textContent = content;
            const okButton = document.querySelector('#message-box button');
            
            okButton.onclick = null; 
            okButton.onclick = () => {
                closeMessageBox();
                if (typeof onOk === 'function') {
                    onOk();
                }
            };

            document.getElementById('message-box').classList.remove('hidden');
            document.getElementById('message-box').classList.add('flex');
        }

        window.closeMessageBox = function() {
            document.getElementById('message-box').classList.add('hidden');
            document.getElementById('message-box').classList.remove('flex');
        }

        // ====================================================================
        // --- SPA ROUTING AND NAVIGATION ---
        // ====================================================================
        
        const VIEWS = ['dashboard', 'create', 'leaderboard'];
        
        window.navigateTo = function(viewId) {
            if (!VIEWS.includes(viewId)) {
                console.error("Invalid view:", viewId);
                return;
            }

            // Hide all views
            VIEWS.forEach(id => {
                const el = document.getElementById(id + '-view');
                if (el) el.classList.add('hidden');
            });
            
            // Show the target view
            const targetEl = document.getElementById(viewId + '-view');
            if (targetEl) targetEl.classList.remove('hidden');

            // Update header title
            const titleMap = {
                'dashboard': 'Dashboard',
                'create': 'Create Bill',
                'leaderboard': 'Reputation Leaderboard'
            };
            document.getElementById('main-header-title').textContent = titleMap[viewId] || 'SplitMate';

            // Load view-specific content
            if (viewId === 'dashboard') {
                loadDashboardContent();
            } else if (viewId === 'leaderboard') {
                loadLeaderboard();
            }
            // Hide mobile menu after navigation
            document.getElementById('mobile-menu').classList.add('hidden');
        }

        // ====================================================================
        // --- DASHBOARD LOGIC ---
        // ====================================================================

        function mockFetchBills() {
            // Mock data structure
            const userAddress = window.currentAddress || "0xAbCd...1234";
            return [
                { id: 1, name: "Dinner at Sushi", amount: 150.75, payer: userAddress, status: "Open", participants: 3, yourShare: 50.25 },
                { id: 2, name: "Netflix Subscription", amount: 19.99, payer: "0xBeef...5678", status: "Open", participants: 4, yourShare: 4.99 },
                { id: 3, name: "Road Trip Gas", amount: 85.00, payer: userAddress, status: "Settled", participants: 2, yourShare: 42.50 },
            ];
        }

        function renderBillCard(bill) {
            const isPayer = bill.payer === (window.currentAddress || "0xAbCd...1234");
            const statusColor = bill.status === 'Open' ? 'text-primary' : 'text-green-400';
            const actionButton = bill.status === 'Open' ? 
                `<button class="bg-secondary text-white px-3 py-1 rounded-full text-sm font-semibold hover:bg-opacity-80 transition">
                    ${isPayer ? 'Manage' : 'Pay Now'}
                </button>` :
                `<span class="text-green-400 text-sm font-semibold">Settled</span>`;

            return `
                <div class="p-4 bg-card rounded-xl border border-border shadow-lg transition duration-300 hover:border-primary/50 flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-3 sm:space-y-0">
                    <div class="flex flex-col">
                        <h3 class="text-xl font-bold text-foreground">${bill.name}</h3>
                        <p class="text-sm text-muted">
                            ${isPayer ? 'You paid' : 'Owed to'} <span class="font-mono text-xs text-primary/80">${bill.payer.substring(0, 6)}...${bill.payer.slice(-4)}</span>
                        </p>
                    </div>
                    
                    <div class="flex items-center space-x-6">
                        <div class="flex flex-col text-right">
                            <span class="text-2xl font-extrabold ${statusColor}">$${bill.yourShare.toFixed(2)}</span>
                            <span class="text-xs text-muted">Your Share</span>
                        </div>
                        ${actionButton}
                    </div>
                </div>
            `;
        }

        window.loadDashboardContent = function() {
            const listContainer = document.getElementById('bill-list');
            if (!listContainer) return;

            // In a real dApp, this would fetch from the contract
            const bills = mockFetchBills(); 
            
            let totalOwed = 0;
            let totalDue = 0;

            listContainer.innerHTML = '';

            if (bills.length === 0) {
                listContainer.innerHTML = '<p class="text-center text-muted p-8">No bills found. Start a new split!</p>';
            } else {
                bills.forEach(bill => {
                    listContainer.insertAdjacentHTML('beforeend', renderBillCard(bill));
                    // Simple balance calculation (mock)
                    if (bill.status === 'Open') {
                        const userAddress = window.currentAddress || "0xAbCd...1234";
                        if (bill.payer === userAddress) {
                            totalOwed += (bill.amount - bill.yourShare); // Amount others owe you
                        } else {
                            totalDue += bill.yourShare; // Amount you owe others
                        }
                    }
                });
            }

            // Update balance displays
            document.getElementById('total-owed').textContent = `$${totalOwed.toFixed(2)}`;
            document.getElementById('total-due').textContent = `$${totalDue.toFixed(2)}`;
            document.getElementById('net-balance').textContent = `$${(totalOwed - totalDue).toFixed(2)}`;
            document.getElementById('net-balance').classList.remove('text-green-400', 'text-red-400');
            document.getElementById('net-balance').classList.add(
                (totalOwed - totalDue) >= 0 ? 'text-green-400' : 'text-red-400'
            );
        }

        // ====================================================================
        // --- CREATE BILL LOGIC (from create.html) ---
        // ====================================================================

        function toggleSplit(type) {
            const manualContainer = document.getElementById('manual-split-container');
            
            document.getElementById('split-type-even').classList.remove('bg-primary/50', 'bg-primary/20');
            document.getElementById('split-type-manual').classList.remove('bg-primary/50', 'bg-primary/20');
            
            if (type === 'even') {
                document.getElementById('split-type-even').classList.add('bg-primary/50');
                manualContainer.classList.add('hidden');
            } else if (type === 'manual') {
                document.getElementById('split-type-manual').classList.add('bg-primary/50');
                manualContainer.classList.remove('hidden');
            }
            // Update hidden input to store selected type
            document.getElementById('split-type-input').value = type;
        }

        function updateParticipants(count) {
            const participantCount = Math.max(0, count);
            document.getElementById('participant-count').value = participantCount;
            document.getElementById('participant-count-display').textContent = participantCount;

            const participantsContainer = document.getElementById('participants-list');
            participantsContainer.innerHTML = '';

            // Generate inputs for manual split
            for (let i = 0; i < participantCount; i++) {
                const index = i + 1;
                const participantInput = `
                    <div class="flex items-center space-x-2 mb-3">
                        <input type="text" placeholder="Participant ${index} Address (0x...)" 
                               class="bg-input/50 border border-border text-foreground rounded-xl px-4 py-2 focus:ring-2 focus:ring-primary focus:border-primary transition duration-300 w-full" 
                               name="participant-${index}-address" required>
                        <input type="number" placeholder="Share ($)" 
                               class="manual-share-input bg-input/50 border border-border text-foreground rounded-xl px-4 py-2 focus:ring-2 focus:ring-primary focus:border-primary transition duration-300 w-1/3" 
                               name="participant-${index}-share" step="0.01" min="0" required>
                    </div>
                `;
                participantsContainer.insertAdjacentHTML('beforeend', participantInput);
            }
        }

        function changeParticipantCount(delta) {
            let currentCount = parseInt(document.getElementById('participant-count').value) || 0;
            currentCount += delta;
            updateParticipants(currentCount);
        }

        function validateForm(formData) {
            // Simple validation: check required fields
            if (!formData.name || !formData.amount || !formData.payer) {
                showMessageBox("Validation Error", "Please fill in all required fields (Name, Amount, Payer).");
                return false;
            }

            if (formData.splitType === 'manual') {
                // Manual split requires participants
                if (formData.participants.length === 0) {
                    showMessageBox("Validation Error", "Please add at least one participant for a manual split.");
                    return false;
                }
                
                let totalShare = 0;
                for (const p of formData.participants) {
                    totalShare += parseFloat(p.share);
                }

                const billAmount = parseFloat(formData.amount);
                // Check if total shares match bill amount
                if (Math.abs(totalShare - billAmount) > 0.01) {
                    showMessageBox("Validation Error", `Manual shares ($${totalShare.toFixed(2)}) do not match the total bill amount ($${billAmount.toFixed(2)}).`);
                    return false;
                }
            }

            return true;
        }


        window.submitBill = async function() {
            const form = document.getElementById('bill-form');
            const splitType = document.getElementById('split-type-input').value;
            const participantCount = parseInt(document.getElementById('participant-count').value);

            // 1. Gather Data
            const formData = {
                name: form.elements['bill-name'].value,
                amount: parseFloat(form.elements['bill-amount'].value),
                payer: form.elements['bill-payer'].value,
                splitType: splitType,
                participants: []
            };

            for (let i = 1; i <= participantCount; i++) {
                formData.participants.push({
                    address: form.elements[`participant-${i}-address`].value,
                    share: parseFloat(form.elements[`participant-${i}-share`]?.value || (formData.amount / participantCount).toFixed(2))
                });
            }

            // 2. Validate Data
            if (!validateForm(formData)) {
                return;
            }

            // 3. Contract/Storage Interaction (Mocking)
            console.log("Submitting Bill Data:", formData);
            // In a real dApp, you would call a contract function here:
            // await window.contract.broadcastBill(formData);

            // Mock storage update (for demonstration)
            let bills = JSON.parse(localStorage.getItem('bills') || '[]');
            bills.push({...formData, id: Date.now(), status: "Open"});
            localStorage.setItem('bills', JSON.stringify(bills));
            
            // 4. Success Message and Redirection
            showMessageBox("Bill Broadcasted!", 
                           `Your bill "${formData.name}" has been successfully broadcasted. Redirecting to Dashboard...`,
                           () => {
                               navigateTo('dashboard');
                           });
        }

        // ====================================================================
        // --- LEADERBOARD LOGIC ---
        // ====================================================================

        function fetchLeaderboardData() {
            // Mock fetching data from a hypothetical reputation contract
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve([
                        { rank: 1, address: "0xBeef...5678", score: 98.5, totalBills: 45, settledRate: 1.0 },
                        { rank: 2, address: "0xAbCd...1234", score: 92.1, totalBills: 20, settledRate: 0.95 },
                        { rank: 3, address: "0xFeed...AbCd", score: 88.9, totalBills: 60, settledRate: 0.88 },
                        { rank: 4, address: "0x1234...5678", score: 75.3, totalBills: 12, settledRate: 1.0 },
                    ]);
                }, 1000);
            });
        }

        function renderLeaderboardList(data) {
            const container = document.getElementById('leaderboard-list');
            let listHtml = '';
            
            data.forEach((player, index) => {
                const rankColor = index === 0 ? 'text-secondary text-2xl' : index === 1 ? 'text-primary/80 text-xl' : index === 2 ? 'text-muted text-lg' : 'text-muted text-base';

                const playerRow = `
                    <div class="flex items-center justify-between p-4 bg-card rounded-lg border border-border mb-3 transition hover:border-primary/50">
                        <div class="flex items-center space-x-4 w-1/2">
                            <span class="font-extrabold ${rankColor}">${index + 1}</span>
                            <div class="flex flex-col">
                                <span class="text-foreground font-semibold">${(window.currentAddress || "0xAbCd...1234") === player.address ? 'You' : player.address.substring(0, 8) + '...'}</span>
                                <span class="text-xs text-muted">Bills: ${player.totalBills}</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-xl font-bold text-primary">${player.score.toFixed(1)}</span>
                            <div class="text-xs text-muted">Settled Rate: ${(player.settledRate * 100).toFixed(1)}%</div>
                        </div>
                    </div>
                `;
                listHtml += playerRow;
            });
            
            container.innerHTML = listHtml;
        }
        
        window.loadLeaderboard = async function() {
            const container = document.getElementById('leaderboard-list');
            if (!container) return;

            container.innerHTML = '<div class="text-center p-8 text-primary font-semibold">Loading reputation scores...</div>';

            try {
                const leaderboardData = await fetchLeaderboardData(); 
                renderLeaderboardList(leaderboardData);

            } catch (error) {
                container.innerHTML = `<div class="text-center p-8 text-red-400">Error loading data. Check console for details.</div>`;
            }
        }


        // ====================================================================
        // --- INITIALIZATION ---
        // ====================================================================

        function setupInitialUI() {
            // Set the default split type to 'even' on the create form
            toggleSplit('even'); 
            // Ensure initial participant count is 0 and buttons are set
            updateParticipants(1); // Start with 1 participant field for the payer address
            
            // Event listeners
            document.getElementById('bill-form').addEventListener('submit', function(e) { 
                e.preventDefault(); 
                submitBill(); 
            });

            document.getElementById('menu-toggle').addEventListener('click', function() {
                document.getElementById('mobile-menu').classList.toggle('hidden');
            });

            // Start the application on the Dashboard page
            navigateTo('dashboard');
        }

        document.addEventListener('DOMContentLoaded', setupInitialUI);
    </script>
</head>
<body class="bg-background min-h-screen text-foreground antialiased overflow-x-hidden">

    <!-- Global Message Box (Modal) -->
    <div id="message-box" class="hidden fixed inset-0 z-50 bg-background/80 backdrop-blur-sm items-center justify-center p-4">
        <div class="bg-[#1a0035] border border-primary/50 rounded-xl p-6 w-full max-w-sm shadow-2xl">
            <h3 id="message-title" class="text-xl font-bold mb-2 text-primary">Notification</h3>
            <p id="message-content" class="text-muted mb-6"></p>
            <div class="flex justify-end">
                <button onclick="closeMessageBox()" class="px-6 py-2 bg-primary/70 rounded-lg text-white font-semibold hover:bg-primary transition duration-200 shadow-lg">
                    OK
                </button>
            </div>
        </div>
    </div>
    
    <!-- Navigation Bar -->
    <nav class="sticky top-0 z-40 bg-background/90 backdrop-blur-md border-b border-border shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo/Brand -->
                <div class="flex-shrink-0">
                    <span class="text-3xl font-extrabold text-primary tracking-wider">Split<span class="text-secondary">Mate</span></span>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden sm:ml-6 sm:flex sm:space-x-4">
                    <a href="#" onclick="navigateTo('dashboard')" class="text-muted hover:text-primary px-3 py-2 rounded-lg text-sm font-medium transition duration-200">Dashboard</a>
                    <a href="#" onclick="navigateTo('create')" class="text-muted hover:text-primary px-3 py-2 rounded-lg text-sm font-medium transition duration-200">Create Bill</a>
                    <a href="#" onclick="navigateTo('leaderboard')" class="text-muted hover:text-primary px-3 py-2 rounded-lg text-sm font-medium transition duration-200">Leaderboard</a>
                </div>
                
                <!-- Wallet/Action Button -->
                <div class="hidden sm:block">
                    <button id="connect-wallet-btn" onclick="window.connectWallet()" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-4 rounded-xl transition duration-300 shadow-md shadow-primary/30">
                        Connect Wallet
                    </button>
                </div>

                <!-- Mobile Menu Button -->
                <div class="sm:hidden flex items-center">
                    <button id="menu-toggle" type="button" class="inline-flex items-center justify-center p-2 rounded-lg text-primary hover:text-white hover:bg-primary/20 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary/50" aria-controls="mobile-menu" aria-expanded="false">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu (Hidden by default) -->
        <div class="sm:hidden hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="#" onclick="navigateTo('dashboard')" class="block px-3 py-2 rounded-lg text-base font-medium text-foreground hover:bg-primary/20 transition">Dashboard</a>
                <a href="#" onclick="navigateTo('create')" class="block px-3 py-2 rounded-lg text-base font-medium text-foreground hover:bg-primary/20 transition">Create Bill</a>
                <a href="#" onclick="navigateTo('leaderboard')" class="block px-3 py-2 rounded-lg text-base font-medium text-foreground hover:bg-primary/20 transition">Leaderboard</a>
                <button onclick="window.connectWallet()" class="w-full text-left px-3 py-2 bg-primary/20 rounded-lg text-base font-medium text-primary hover:bg-primary/40 transition">Connect Wallet</button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <h1 id="main-header-title" class="text-3xl sm:text-4xl font-extrabold text-foreground mb-8 border-b-2 border-primary/20 pb-2">Dashboard</h1>

        <!-- ====================================================================
             DASHBOARD VIEW
             ==================================================================== -->
        <section id="dashboard-view" class="space-y-8">
            
            <!-- Balance Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <div class="bg-card rounded-xl p-6 border border-border shadow-2xl">
                    <h2 class="text-muted text-lg font-medium mb-1">Total Owed To You</h2>
                    <p id="total-owed" class="text-4xl font-extrabold text-green-400">$0.00</p>
                </div>
                
                <div class="bg-card rounded-xl p-6 border border-border shadow-2xl">
                    <h2 class="text-muted text-lg font-medium mb-1">Total You Owe</h2>
                    <p id="total-due" class="text-4xl font-extrabold text-red-400">$0.00</p>
                </div>

                <div class="bg-card rounded-xl p-6 border border-border shadow-2xl">
                    <h2 class="text-muted text-lg font-medium mb-1">Net Balance</h2>
                    <p id="net-balance" class="text-4xl font-extrabold text-foreground">$0.00</p>
                </div>
            </div>

            <!-- Recent Bills/Actions -->
            <div>
                <h2 class="text-2xl font-bold text-primary mb-4">Your Recent Bills</h2>
                <div id="bill-list" class="space-y-4">
                    <!-- Bill cards will be injected here by loadDashboardContent() -->
                    <div class="text-center p-8 text-muted">Loading bills...</div>
                </div>
            </div>

            <div class="pt-4 text-center">
                <button onclick="navigateTo('create')" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-8 rounded-xl transition duration-300 text-lg shadow-lg shadow-primary/30">
                    Split a New Bill
                </button>
            </div>

        </section>

        <!-- ====================================================================
             CREATE BILL VIEW
             ==================================================================== -->
        <section id="create-view" class="hidden">
            <div class="max-w-2xl mx-auto bg-card p-6 sm:p-8 rounded-xl border border-border shadow-2xl">
                <form id="bill-form" class="space-y-6">

                    <!-- Bill Name and Amount -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="bill-name" class="block text-sm font-medium text-muted mb-2">Bill Name (e.g., Dinner, Rent)</label>
                            <input type="text" id="bill-name" name="bill-name" required placeholder="Enter bill name"
                                   class="bg-input/50 border border-border text-foreground rounded-xl px-4 py-3 focus:ring-2 focus:ring-primary focus:border-primary transition duration-300 w-full"
                            >
                        </div>
                        <div>
                            <label for="bill-amount" class="block text-sm font-medium text-muted mb-2">Total Amount (USDC/ETH)</label>
                            <input type="number" id="bill-amount" name="bill-amount" required step="0.01" min="0.01" placeholder="100.00"
                                   class="bg-input/50 border border-border text-foreground rounded-xl px-4 py-3 focus:ring-2 focus:ring-primary focus:border-primary transition duration-300 w-full"
                            >
                        </div>
                    </div>

                    <!-- Payer Address -->
                    <div>
                        <label for="bill-payer" class="block text-sm font-medium text-muted mb-2">Payer Address (Who paid the full amount)</label>
                        <input type="text" id="bill-payer" name="bill-payer" required placeholder="0x..."
                               class="bg-input/50 border border-border text-foreground rounded-xl px-4 py-3 focus:ring-2 focus:ring-primary focus:border-primary transition duration-300 w-full"
                        >
                    </div>

                    <!-- Split Type Toggle -->
                    <div>
                        <label class="block text-sm font-medium text-muted mb-3">Split Type</label>
                        <input type="hidden" id="split-type-input" value="even">
                        <div class="flex space-x-4">
                            <button type="button" id="split-type-even" onclick="toggleSplit('even')"
                                    class="flex-1 px-4 py-3 rounded-xl border border-primary/50 text-foreground font-semibold transition duration-200 bg-primary/50 hover:bg-primary/20">
                                Evenly
                            </button>
                            <button type="button" id="split-type-manual" onclick="toggleSplit('manual')"
                                    class="flex-1 px-4 py-3 rounded-xl border border-primary/50 text-foreground font-semibold transition duration-200 hover:bg-primary/20">
                                Manual Shares
                            </button>
                        </div>
                    </div>
                    
                    <!-- Participants and Manual Split Container -->
                    <div>
                        <label class="block text-sm font-medium text-muted mb-3">Number of Participants (excluding Payer, if Payer is already listed above)</label>
                        
                        <div class="flex items-center space-x-4 bg-input/50 p-3 rounded-xl border border-border">
                            <button type="button" onclick="changeParticipantCount(-1)" 
                                    class="w-10 h-10 bg-primary/20 text-primary rounded-lg text-2xl font-bold hover:bg-primary/40 transition duration-200">
                                &minus;
                            </button>
                            <input type="number" id="participant-count" name="participant-count" value="1" min="1" readonly
                                   class="w-16 text-center text-foreground bg-transparent text-xl font-bold border-none focus:outline-none">
                            <button type="button" onclick="changeParticipantCount(1)" 
                                    class="w-10 h-10 bg-primary/20 text-primary rounded-lg text-2xl font-bold hover:bg-primary/40 transition duration-200">
                                &plus;
                            </button>
                        </div>
                    </div>

                    <div id="manual-split-container" class="space-y-4 hidden pt-4 border-t border-border mt-6">
                        <h3 class="text-xl font-bold text-primary">Participant Details</h3>
                        <div id="participants-list">
                            <!-- Participant address and share inputs are generated here by updateParticipants() -->
                        </div>
                        <p class="text-xs text-muted">For Manual Split, ensure the sum of all 'Share' fields equals the 'Total Amount'.</p>
                    </div>
                    
                    <!-- Submit Button -->
                    <button type="submit" 
                            class="w-full bg-secondary hover:bg-secondary/90 text-white font-bold py-3 rounded-xl transition duration-300 text-lg shadow-lg shadow-secondary/30">
                        Broadcast Bill to SplitMate
                    </button>
                </form>
            </div>
        </section>

        <!-- ====================================================================
             LEADERBOARD VIEW
             ==================================================================== -->
        <section id="leaderboard-view" class="hidden">
            <div class="max-w-3xl mx-auto">
                <div class="bg-card p-6 rounded-xl border border-border shadow-2xl mb-6">
                    <p class="text-muted text-center">
                        The SplitMate Leaderboard ranks users based on their on-chain bill settlement history. Higher reputation scores indicate a greater commitment to prompt payments.
                    </p>
                </div>
                
                <div class="mb-4 flex justify-between items-center text-sm font-semibold text-muted border-b border-border pb-2">
                    <span class="w-1/2">Rank / Address</span>
                    <span class="text-right">Reputation Score / Settled Rate</span>
                </div>

                <div id="leaderboard-list" class="space-y-3">
                    <!-- Leaderboard rows will be injected here by loadLeaderboard() -->
                    <div class="text-center p-8 text-muted">Loading leaderboard...</div>
                </div>
            </div>
        </section>
        
    </main>
</body>
</html>
